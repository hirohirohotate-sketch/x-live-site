# LiveShelf – Product & Architecture Principles

このドキュメントは、LiveShelf の開発において  
**思想・設計・実装判断がぶれないための基準**を定義する。

Claude Sonnet / 他LLMに指示を出す際は、必ず本ドキュメントを前提として扱うこと。

---

## 1. プロダクトの本質（WHY）

LiveShelf は **「Xのライブ配信を“発見する”サービスではない」**。

本質は以下である：

- 配信後に流れて消えるライブ配信の **アーカイブURLを回収する**
- 配信者ごとに **棚（Shelf）として整理する**
- 人間が後から **文章・文脈・価値** を付与できる場所を提供する

👉  
**主語は「動画」ではなく「URLと記録」**。

---

## 2. やらないこと（最重要）

以下は **明確にスコープ外** とする。

- ❌ ライブ動画の再配信・埋め込み再生
- ❌ Xの代替UIを作ること
- ❌ 完全リアルタイムなライブ検知
- ❌ R18コンテンツを主軸にした設計
- ❌ APIで全世界のライブを網羅すること

LiveShelf は **軽く・壊れにくく・長く運用できる** ことを最優先する。

---

## 3. データ設計の原則（不変）

### 3.1 正のID
- 配信者の正規IDは **x_user_id（数値）**
- ただし初期段階では未取得でも良い（nullable）
- `x_username` は暫定キーであり、将来変更されうる

👉  
**username 依存の設計に固定しないこと**

---

### 3.2 データの正規化
- broadcast は **URLではなく broadcast_id** を正とする
- URLは必ず正規化する  
  `https://x.com/i/broadcasts/<id>`

---

### 3.3 ソースの抽象化
すべての broadcast は、どの経路で入ったかを持つ。

例：
- `api_recent_search`
- `manual`
- `import_csv`
- `oauth_webhook`（将来）

👉  
**取得方法が変わってもDB構造は変えない**

---

## 4. 所有権と信頼モデル

### 4.1 なりすまし対策
- 棚（broadcaster）には **所有者概念**を持たせる
- 初期は OAuth に依存しない
- クレーム方式（bio / tweet による検証）を許容する

### 4.2 編集権限
- 公開閲覧：誰でも可
- 編集（文章・タグ・固定）：**所有者のみ**

👉  
荒れやすい「誰でも編集」は最初からやらない。

---

## 5. フロントエンド設計思想（Next.js）

### 5.1 ページの役割
- `/` : 新着 / 人気などの「入口」
- `/u/[username]` : 配信者の棚（SEOの核）
- `/b/[broadcast_id]` : 個別アーカイブ + 文章

### 5.2 UIの姿勢
- 見た目より **意味のある情報密度**
- 動画は表示しない（Xへ遷移）
- テキスト（文章・メモ・タイムスタンプ）を主役にする

---

## 6. API利用の原則

- X APIは **公開投稿の検索・整理のみ**
- 再配信・再保存は行わない
- APIコストは **初期投資で止まる設計**を維持する
- ユーザー増加 = API負荷増加 にならない構造を守る

---

## 7. MVPと拡張の考え方

### 7.1 最初にやること
- 管理されていないライブアーカイブを並べる
- DBに保存する
- 棚として見せる

### 7.2 需要が見えたらやること
- ログイン
- 所有権の主張
- 通知
- 自動収集の精度向上

👉  
**最初から全部やらない。だるい手戻りを避ける。**

---

## 8. LLM（Claude Sonnet）への指示ルール

Claude にコードや設計を依頼する場合：

- 本ドキュメントの思想を前提にすること
- 「便利そう」「一般的だから」という理由で機能を足さない
- 不明な点は **勝手に補完せず質問する**

---

## 9. 合言葉（判断に迷ったら）

> これは  
> **「棚として強くなるか？」  
> 「手戻りを減らすか？」  
> 「Xの代替になっていないか？」**

この3つで判断する。

---

## END